---
layout: single
title: "[Spring] ìŠ¤í”„ë§ ë³µìŠµ ë° ì •ë¦¬ 4P"
permalink: /68
categories: [All, Spring, ê¸°ì´ˆ]
toc: true
toc_sticky: true
toc_label: index
toc_icon: "fa-solid fa-indent"
author_profile: false
---
AOP (Aspect Oriented Programming ê´€ì‹¬ ì§€í–¥ í”„ë¡œê·¸ë˜ë°)

<div class="cl1"></div>

## AOPë€?

**ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì˜ ê³¼ì •ì—ì„œ ì—¬ëŸ¬ ê°ì²´ì— ê³µí†µì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³µí†µì˜ ê´€ì‹¬ ì‚¬í•­ (Cross-cutting Concern)ê³¼**

**í•µì‹¬ ë¡œì§ê³¼ ê´€ë ¨í•œ í•µì‹¬ ê´€ì‹¬ ì‚¬í•­(Cross-cutting concern)ì„ ë¶„ë¦¬ì‹œí‚¤ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ë²•**ì„ ì˜ë¯¸í•œë‹¤.

<div class="cl3"></div>

êµ¬ì²´ì ì¸ ì˜ˆì‹œë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ, ë¡œê¹…, íŠ¸ëœì ì…˜ ë“± ê³µí†µì ì¸ ê´€ì‹¬ ì‚¬í•­ì„ ë¶„ë¦¬ì‹œì¼œ ê´€ë¦¬í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ì´ ìˆë‹¤.

<div class="cl4"></div>

<p align="center"><img src="../images/68md1.png"></p>

<div class="cl4"></div>

ì´ë ‡ê²Œ AOPë¥¼ ì ìš©í•˜ì—¬ ê³µí†µì˜ ê´€ì‹¬ ì‚¬í•­ê³¼ í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ì˜ ê¸°ëŠ¥ì„ êµ¬ë¶„í•˜ì—¬ ì½”ë“œë¥¼ ì„¤ê³„í•˜ë©´,

**ì½”ë“œì˜ ê°„ê²°ì„±ê³¼ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê³ , ê°ì²´ì§€í–¥ ì„¤ê³„ ì›ì¹™ì— ì¢€ ë” ë¶€í•©í•˜ëŠ” ì½”ë“œë¥¼ êµ¬í˜„**í•  ìˆ˜ ìˆë‹¤.

<div class="cl1"></div>

## í”„ë¡ì‹œ ê°ì²´

- í”„ë¡ì‹œ ê°ì²´ëŠ” ë‹¤ë¥¸ ê°ì²´ì— ëŒ€í•œ ëŒ€ë¦¬ì ì—­í• ì„ í•˜ëŠ” ê°ì²´ì´ë‹¤. <br> ì£¼ë¡œ AOPì—ì„œ ì‚¬ìš©ë˜ë©°, í•µì‹¬ ê°ì²´(Core Object)ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê³  ì¶”ê°€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

- í”„ë¡ì‹œ ê°ì²´ëŠ” í•µì‹¬ ê°ì²´ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , í•µì‹¬ ê°ì²´ì— ëŒ€í•œ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

- í”„ë¡ì‹œ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ AOP ì¸¡ë©´ì—ì„œ ê´€ì‹¬ì‚¬ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜, í•µì‹¬ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ ì „/í›„ì— ì¶”ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

- í”„ë¡ì‹œ ê°ì²´ëŠ” ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê³ , ì½”ë“œ ì¤‘ë³µì„ ì¤„ì´ë©°, ìœ ì§€ ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œí‚¨ë‹¤.

<div class="cl3"></div>

ì˜ˆë¥¼ ë“¤ì–´, AOPë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì†Œë“œ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡ì‹œ ê°ì²´ ë° AOP ì–´ë“œë°”ì´ìŠ¤ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```java
// í•µì‹¬ ê°ì²´
public class MyService {
    public void doSomething() {
        // í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    }
}

// AOP ì–´ë“œë°”ì´ìŠ¤
public class TimingAdvice {
    public void measureTime(JoinPoint joinPoint) {
        long startTime = System.currentTimeMillis();
        joinPoint.proceed(); // í•µì‹¬ ê°ì²´ì˜ ë©”ì†Œë“œ ì‹¤í–‰
        long endTime = System.currentTimeMillis();
        System.out.println("ë©”ì†Œë“œ ì‹¤í–‰ ì‹œê°„: " + (endTime - startTime) + "ms");
    }
}

// í”„ë¡ì‹œ ì„¤ì •
@Configuration
@EnableAspectJAutoProxy
public class AppConfig {
    @Bean
    public MyService myService() {
        return new MyService();
    }
    
    @Bean
    public TimingAdvice timingAdvice() {
        return new TimingAdvice();
    }
}
```

ìœ„ì˜ ì½”ë“œì—ì„œ `TimingAdvice`ëŠ” í•µì‹¬ ë©”ì†Œë“œë¥¼ ê°ì‹¸ì„œ ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ê³ , `AppConfig`ì—ì„œ `@EnableAspectJAutoProxy`ë¥¼ ì‚¬ìš©í•˜ì—¬ AOPë¥¼ í™œì„±í™”í•œë‹¤.

ì´ë ‡ê²Œ êµ¬ì„±í•˜ë©´ `MyService`ì˜ ë©”ì†Œë“œ í˜¸ì¶œ ì‹œê°„ì„ ìë™ìœ¼ë¡œ ì¸¡ì •í•  ìˆ˜ ìˆë‹¤.

<div class="cl2"></div>

### ì˜ˆì‹œ

<div class="cl4"></div>

**Gugudan ì¸í„°í˜ì´ìŠ¤**

```java
public interface Gugudan {

    // ì¶”ìƒ ë©”ì„œë“œ ì •ì˜
    void calculate(int level, int count);
}
```

<div class="cl3"></div>

**GugudanByForLoop í´ë˜ìŠ¤**

```java
public class GugudanByForLoop implements Gugudan {

    // forë¬¸ì„ ì‚¬ìš©í•œ êµ¬êµ¬ë‹¨ ë©”ì„œë“œ
	  @Override
    public void calculate(int level, int number) {

       for(int count = number; count < 10; count++) {
            System.out.printf("%d x %d = %d\n", level, count, level * count);
        }
   }
}
```

<div class="cl3"></div>

**GugudanByRecursion í´ë˜ìŠ¤**

```java
public class GugudanByRecursion implements Gugudan {

    // ì¬ê·€í˜¸ì¶œë¡œ êµ¬í˜„í•œ êµ¬êµ¬ë‹¨
    @Override
    public void calculate(int level, int count) {
        
	if(count > 9) {
          return;
          }
        System.out.printf("%d x %d = %d\n", level, count, level*count);
        calculate(level, ++count);
    }
}
```

<div class="cl3"></div>

**GugudanProxy í´ë˜ìŠ¤**

```java
public class GugudanProxy implements Gugudan {

    private Gugudan delegator;

    public GugudanProxy(Gugudan delegator) {
        this.delegator = delegator;
    }

    @Override
    public void calculate(int level, int count) {
        long start = System.nanoTime();
        delegator.calculate(2,1);
        long end = System.nanoTime();
        System.out.printf("í´ë˜ìŠ¤ëª…: = %s\n", delegator.getClass().getSimpleName());
        System.out.printf("ì‹¤í–‰ ì‹œê°„ = %d ms\n", (end - start));
        System.out.println("-------------------------------");
    }
}
```

<div class="cl3"></div>

**GugudanTest í´ë˜ìŠ¤**

```java
public class GugudanTest {

    public static void main(String[] args) {

        GugudanByForLoop gugudanByForLoop = new GugudanByForLoop();
	System.out.println("ğŸ¯ forë¬¸ êµ¬êµ¬ë‹¨ 2ë‹¨");
        GugudanProxy proxy = new GugudanProxy(gugudanByForLoop);
        proxy.calculate(2,1);

        GugudanByRecursion gugudanByRecursion = new GugudanByRecursion();
        System.out.println("ğŸ¯ ì¬ê·€ êµ¬êµ¬ë‹¨ 2ë‹¨");
        GugudanProxy proxy2 = new GugudanProxy(gugudanByRecursion);
        proxy2.calculate(2, 1);

    }
}
```

<div class="cl3"></div>

**ì¶œë ¥ í™”ë©´**

<p align="center"><img src="../images/68md2.png"></p>

<div class="cl4"></div>

ì´ì²˜ëŸ¼ GugudanProxy í´ë˜ìŠ¤ì™€ ê°™ì´ í•µì‹¬ ê¸°ëŠ¥ì„ ë‹¤ë¥¸ ê°ì²´ì—ê²Œ ìœ„ì„í•˜ê³ ,

ë™ì‹œì— ì‹¤í–‰ ì‹œê°„ ì¸¡ì •ê³¼ ê°™ì€ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê°ì²´ë¥¼ í”„ë¡ì‹œë¼ê³  ë¶€ë¥¸ë‹¤.

<div class="cl3"></div>

í”„ë¡ì‹œì˜ ì¡´ì¬ë¡œ ì¸í•´ ì½”ë“œì˜ ì¤‘ë³µì„ ì—†ì• ê³ , ê¸°ì¡´ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ë„ ì‹¤í–‰ ì‹œê°„ì„ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

<div class="cl3"></div>

**GugudanProxy í´ë˜ìŠ¤ëŠ” ì‹¤í–‰ ì‹œê°„ ì¸¡ì •ì´ë¼ëŠ” ê³µí†µ ì‚¬í•­ ë¡œì§ì— ì§‘ì¤‘í•˜ê³ ,**

**GugudanByForLoopí´ë˜ìŠ¤ì™€ GugudanByRecursion í´ë˜ìŠ¤ì—ì„œ êµ¬êµ¬ë‹¨ ê³„ì‚°ì— ëŒ€í•œ í•µì‹¬ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ì—¬ ì—­í• ì„ ë¶„ë¦¬ì‹œì¼°ë‹¤.**

<div class="cl2"></div>

## AOPì˜ í•µì‹¬ ê°œë…

- AOPë€ **ê³µí†µ ê´€ì‹¬ ì‚¬í•­ê³¼ í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ì„ ë¶„ë¦¬ì‹œì¼œ ì½”ë“œì˜ ì¤‘ë³µì„ ì œê±°í•˜ê³ , ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ëŠ” í”„ë¡œê·¸ë˜ë° ë°©ë²•ë¡ **ì„ ì˜ë¯¸í•œë‹¤.

- AOPì€ **í•µì‹¬ ê¸°ëŠ¥ì— ê³µí†µê¸°ëŠ¥ì„ ì‚½ì…í•˜ëŠ” ê²ƒ**ìœ¼ë¡œ, ì´ë¥¼ í†µí•´ **í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ ê³µí†µ ê¸°ëŠ¥ì˜ êµ¬í˜„ì„ ì¶”ê°€ ë˜ëŠ” ë³€ê²½í•˜ëŠ” ê²ƒ**ì´ ê°€ëŠ¥í•˜ë‹¤.

<div class="cl3"></div>

ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” **í”„ë¡ì‹œ ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì—¬ AOPë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ì‹**ì„ ì§€ì›í•˜ê³  ìˆë‹¤.

<div class="cl3"></div>

ì°¸ê³ ë¡œ, í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì™¸ì—ë„ ì»´íŒŒì¼ ì‹œì ì— ì½”ë“œì— ê³µí†µ ê¸°ëŠ¥ì„ ì‚½ì…í•˜ê±°ë‚˜

í´ë˜ìŠ¤ ë¡œë”© ì‹œì ì— ê³µí†µ ê¸°ëŠ¥ì„ ì‚½ì…í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤. (í´ë˜ìŠ¤ ë¡œë”© ì‹œì , ëŸ°íƒ€ì„ ì‹œì )

<p align="center"><img src="../images/68md3.png"></p>

ìŠ¤í”„ë§ AOPëŠ” ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ **íƒ€ê¹ƒ ê°ì²´ë¥¼ ì™¸ë¶€ì—ì„œ í”„ë¡ì‹œ ê°ì²´ê°€ í•œë²ˆ ê°ì‹¸ëŠ” êµ¬ì¡°**ë¥¼ ê°€ì§€ê³  ìˆë‹¤.

ë”°ë¼ì„œ, ì„¤ì •ì— ë”°ë¼ íƒ€ê¹ƒ ê°ì²´ì˜ í•µì‹¬ ë¡œì§ì´ ì‹¤í–‰ë˜ê¸° ì „ê³¼ í›„ì— ê³µí†µ ê¸°ëŠ¥ì„ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

<div class="cl3"></div>

í•œ ê°€ì§€ ì°¨ì´ëŠ”, ì•ì˜ í”„ë¡ì‹œ ê°ì²´ ì˜ˆì‹œì—ì„œëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í–ˆì§€ë§Œ,

**ìŠ¤í”„ë§ì˜ ê²½ìš° í•´ë‹¹ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìŠ¤í”„ë§ì´ ìë™ì ìœ¼ë¡œ ìƒì„±**í•´ ì£¼ê¸° ë•Œë¬¸ì— GugudanProxy í´ë˜ìŠ¤ì™€ ê°™ì€ ê°ì²´ë¥¼ ë”°ë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ë‹¤.

<div class="cl3"></div>

<p align="center"><img src="../images/68md4.png"></p>

AOPì—ì„œëŠ” ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì— ëŒ€í•œ ê¸°ëŠ¥ì„ **ì• ìŠ¤í™íŠ¸(Aspect)**ë¼ê³  ë¶€ë¥¸ë‹¤.

<div class="cl3"></div>

AOPì—ì„œ ì²« ë²ˆì§¸ Aì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ê¸°ë„ í•œë°,

ê³µí†µ ê¸°ëŠ¥ê³¼ ì ìš© ì‹œì ì„ ì •ì˜í•œ **ì–´ë“œë°”ì´ìŠ¤(Advide)**ì™€ ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ë  ì§€ì ì„ ì •ì˜í•˜ëŠ” **í¬ì¸íŠ¸ì»·(Pointcut)**ì˜ ì¡°í•©ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

íŠ¸ëœì­ì…˜ì´ë‚˜ ë³´ì•ˆ ë“±ì´ ì• ìŠ¤í™íŠ¸ì˜ ëŒ€í‘œì ì¸ ì˜ˆì‹œì´ë‹¤.

<p align="center"><img src="../images/68md5.png"></p>

<p align="center"><img src="../images/68md6.png"></p>

**ìŠ¤í”„ë§ì—ì„œ êµ¬í˜„ ê°€ëŠ¥í•œ ì–´ë“œë°”ì´ìŠ¤ì˜ ì¢…ë¥˜**ëŠ” ëª‡ ê°€ì§€ê°€ ìˆëŠ”ë°, ì•„ë˜ì™€ ê°™ì´ ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì‹œì ì— ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚½ì…í•  ìˆ˜ ìˆë‹¤.

- **@Before**
    - íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œ í˜¸ì¶œ ì „ì— ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰
- **@After**
    - ì˜ˆì™¸ ë°œìƒ ì—¬ë¶€ì— ê´€ê³„ì—†ì´ íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œ ì‹¤í–‰ í›„ ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰
- **@AfterReturning**
    - íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œê°€ ì˜ˆì™¸ ì—†ì´ ì‹¤í–‰ë˜ì–´ ê°’ì„ ë°˜í™˜í•œ ê²½ìš° ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰
- **@AfterThrowing**
    - íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œ ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰
- **@Around**
    - íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œ ì‹¤í–‰ ì „ê³¼ í›„ ë˜ëŠ” ì˜ˆì™¸ ë°œìƒ ì‹œ ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰
    - ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ ì‚¬ìš©ë¨

<div class="cl1"></div>

## AOP êµ¬í˜„

**ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ì€ ê³µí†µ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” Aspect êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ì¼ì´ë‹¤.**

<div class="cl3"></div>

**GugudanAspect í´ë˜ìŠ¤**

ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ì •ì˜í•˜ëŠ” Aspect êµ¬í˜„ í´ë˜ìŠ¤

```java
// (1) @Aspect
@Aspect
public class GugudanAspect {

    // (2) @PointCut
		// @Pointcut("execution(public void cal*(..))")
    @Pointcut("execution(public void com..calculate(..))")
    private void targetMethod() {}

    // (3) @Around
    @Around("targetMethod()")
    public Object measureTime(ProceedingJoinPoint joinPoint) throws Throwable {

        long start = System.nanoTime();

        try {
            Object result = joinPoint.proceed();
            return result;
        } finally {
            long end = System.nanoTime();
            Signature signature = joinPoint.getSignature();
            System.out.printf("%s.%s ë©”ì„œë“œ í˜¸ì¶œ!\n", joinPoint.getTarget().getClass().getSimpleName(), signature.getName());
            System.out.printf("ì‹¤í–‰ ì‹œê°„: %d ns", (end-start));
        }
    }
}
```

<div class="cl4"></div>

**(1) @Aspect**

ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼, ì• ìŠ¤í™íŠ¸ëŠ” **ê³µí†µ ê¸°ëŠ¥**ê³¼ ê·¸ **ì ìš© ì‹œì ì„ ì •ì˜í•œ ì–´ë“œë°”ì´ìŠ¤**,

ê·¸ë¦¬ê³  ì´ê²ƒì„ **ì ìš©í•  ì§€ì ì„ ì˜ë¯¸í•˜ëŠ” í¬ì¸íŠ¸ì»·**ì„ í¬í•¨í•˜ëŠ”ë°,

í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ ê°ê° **(2) @Pointcutê³¼ (3) @Around ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ êµ¬í˜„**ëœë‹¤.

<div class="cl3"></div>

**(2) @Pointcut**

ì• ìŠ¤í™íŠ¸ë¥¼ ì ìš©í•  ìœ„ì¹˜ë¥¼ ì§€ì •í•  ë•Œ ì‚¬ìš©í•˜ëŠ” í¬ì¸íŠ¸ì»·ì˜ ì„¤ì •ì„ ë³´ë©´ `execution()` ìœ¼ë¡œ ì‹œì‘ë˜ëŠ” ëª…ì‹œìë¥¼ ì‚¬ìš©í•˜ì—¬ 

ì–´ë“œë°”ì´ìŠ¤ì˜ ëŒ€ìƒì´ ë˜ëŠ” ë©”ì„œë“œë¥¼ ì§€ì •í•˜ê³  ìˆëŠ”ë°, ê·¸ ë¬¸ë²• êµ¬ì¡°ëŠ” ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ë‹¤.

<div class="cl4"></div>

<p align="center"><img src="../images/68md7.png"></p>

<div class="cl4"></div>

ìœ„ì—ì„œ ëŒ€ê´„í˜¸ë¡œ í‘œì‹œëœ ë¶€ë¶„ì€ ìƒëµ ê°€ëŠ¥í•˜ê³ , ê° íŒ¨í„´ì€ * ê¸°í˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ê°’ì„ í‘œí˜„í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ ì  ë‘ê°œ(..)ë¥¼ ì‚¬ìš©í•˜ì—¬ 0ê°œ ì´ìƒì˜ ìˆ˜ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

```java
@Pointcut("execution(public void com..calculate(..))")
@Pointcut*("execution(* cal*(..))")
```

<div class="cl3"></div>

**(3) @Around**

**@Around ì–´ë…¸í…Œì´ì…˜ì€** **íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œ ì‹¤í–‰ ì „ê³¼ í›„ ë˜ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‚¬ìš©í•œë‹¤.**

<div class="cl3"></div>

@Around ì–´ë…¸í…Œì´ì…˜ ê°’ìœ¼ë¡œ `targerMethod()`ê°€ ì •ì˜ë˜ì—ˆëŠ”ë°, ì´ê²ƒì€ `targetMethod()`ì— ì •ì˜í•œ í¬ì¸íŠ¸ì»·ì— ê³µí†µ ê¸°ëŠ¥ì„ ì ìš©í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

<div class="cl3"></div>

ì¦‰, ì•ì—ì„œ ì •ì˜í•œ ëŒ€ìƒ ë©”ì„œë“œë“¤ì˜ ì‹¤í–‰ ì „ê³¼ í›„ì— ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

ì—¬ê¸°ì„œ ê³µí†µ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ë©”ì„œë“œëŠ” ìœ„ì—ì„œ ì •ì˜í•œ `measureTime()`ì´ë©°, ë©”ì„œë“œ ë°”ë””ì— ì‹¤í–‰ ì‹œê°„ ì¸¡ì •ì„ ìœ„í•œ ë¡œì§ì´ ì‘ì„±ëœë‹¤.

<div class="cl3"></div>

`measureTime(ProceedingJoinPoint joinPoint)`ì˜ `ProceedingJoinPoint` **íƒ€ì…ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” íƒ€ê¹ƒ ê°ì²´ì˜ ì‹¤ì œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©**ë˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ì´ `proceed()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.

```java
Object result = joinPoint.proceed();
```

ì´ë ‡ê²Œ `proceed()` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ **ì‹¤ì œ íƒ€ê¹ƒì´ ë˜ëŠ” ê°ì²´ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.**

<div class="cl3"></div>

**ê³µí†µ ê´€ì‹¬ ê¸°ëŠ¥ ì •ì˜ & í•µì‹¬ ê¸°ëŠ¥ í˜¸ì¶œ**

```java
@Around("targetMethod()")
public Object measureTime(ProceedingJoinPoint joinPoint) throws Throwable {

    // í•µì‹¬ ê¸°ëŠ¥ ë¡œì§ ì‹¤í–‰ ì „ í˜¸ì¶œ
    long start = System.nanoTime();

    try {
        // í•µì‹¬ ê¸°ëŠ¥ í˜¸ì¶œ
        Object result = joinPoint.proceed();
        return result;
    } finally {
        // í•µì‹¬ ê¸°ëŠ¥ ë¡œì§ ì‹¤í–‰ í›„ í˜¸ì¶œ 
        long end = System.nanoTime();
        Signature signature = joinPoint.getSignature();
        System.out.printf("%s.%s ë©”ì„œë“œ í˜¸ì¶œ!\n", joinPoint.getTarget().getClass().getSimpleName(), signature.getName());
        System.out.printf("ì‹¤í–‰ ì‹œê°„: %d ns", (end-start));
    }
}
```

**ProceedingJoinPoint ì¸í„°í˜ì´ìŠ¤ëŠ” ìœ„ì˜ `getSignature()` , `getTarget()` ë“± í˜¸ì¶œí•œ ë©”ì„œë“œì˜ ì‹œê·¸ë‹ˆì²˜ì™€ ëŒ€ìƒ ê°ì²´ë¥¼ êµ¬í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.**

<div class="cl3"></div>

ì´ ì™¸ì—ë„ **ë§¤ê°œ ë³€ìˆ˜ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” `getArgs()` ë©”ì„œë“œ**ê°€ ìˆë‹¤.

íŠ¹ë³„íˆ `getSignature()` ë©”ì„œë“œëŠ” Signature íƒ€ì…ì˜ ê°’ì„ ë°˜í™˜í•˜ëŠ” ë° 

í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ `getName()` , `toShortString()` , `toLongString()`ê³¼ ê°™ì€ ë©”ì„œë“œì˜ ì •ë³´ë¥¼ ì œê³µë°›ì„ ìˆ˜ ìˆë‹¤.

<div class="cl2"></div>

### ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡

**GugudanConfig í´ë˜ìŠ¤**

```java
@Configuration
@EnableAspectJAutoProxy // @Aspect ì• ë…¸í…Œì´ì…˜ ë¶™ì¸ í´ë˜ìŠ¤ë¥¼ ê³µí†µ ê¸°ëŠ¥ìœ¼ë¡œ ì ìš©
public class GugudanConfig {

    @Bean
    public GugudanAspect gugudanAspect() {
        return new GugudanAspect();
    }

    // Forë¬¸ì„ ì‚¬ìš©í•œ êµ¬êµ¬ë‹¨ ê°ì²´ ë¹ˆ ë“±ë¡
    @Bean
    public Gugudan gugudan() {
        return new GugudanByForLoop();
    }
}
```

**@EnableAspectJAutoProxy ì• ë„ˆí…Œì´ì…˜ì€ ìŠ¤í”„ë§ìœ¼ë¡œ @Aspect ì• ë„ˆí…Œì´ì…˜ì´ ë¶™ì€ ë¹ˆ ê°ì²´ë¥¼ ì°¾ì•„ í•´ë‹¹ ê°ì²´ì˜ í¬ì¸íŠ¸ì»·ê³¼ ì–´ë“œë°”ì´ìŠ¤ ì„¤ì •ì„ ì‚¬ìš©**í•˜ë„ë¡ í•œë‹¤.

<div class="cl3"></div>

**GugudanTest í´ë˜ìŠ¤**

```java
public class GugudanTest {

    public static void main(String[] args) {

        // ë ˆê±°ì‹œ ì½”ë“œ
//        GugudanByForLoop gugudanByForLoop = new GugudanByForLoop();
//        System.out.println("ğŸ¯ forë¬¸ êµ¬êµ¬ë‹¨ 2ë‹¨");
//        GugudanProxy proxy = new GugudanProxy(gugudanByForLoop);
//        proxy.calculate(2,1);
//
//        GugudanByRecursion gugudanByRecursion = new GugudanByRecursion();
//        System.out.println("ğŸ¯ ì¬ê·€ êµ¬êµ¬ë‹¨ 2ë‹¨");
//        GugudanProxy proxy2 = new GugudanProxy(gugudanByRecursion);
//        proxy2.calculate(2, 1);

        AnnotationConfigApplicationContext annotationConfigApplicationContext = new AnnotationConfigApplicationContext(GugudanConfig.class);

        Gugudan gugudan = annotationConfigApplicationContext.getBean("gugudan", Gugudan.class);
        gugudan.calculate(2,1);
    }
}
```

<div class="cl1"></div>

## ì—¬ëŸ¬ ê°œì˜ Advice ì‚¬ìš©

ê²½ìš°ì— ë”°ë¼, í•˜ë‚˜ì˜ í¬ì¸íŠ¸ì»·ì— ì—¬ëŸ¬ ê°œì˜ ì–´ë“œë°”ì´ìŠ¤ë¥¼ ì ìš©í•  ìˆ˜ë„ ìˆë‹¤.

<div class="cl3"></div>

**GugudanCacheAspect í´ë˜ìŠ¤**

```java
@Aspect
public class GugudanCacheAspect {

    // ìºì‹œ ì €ì¥ì†Œ
    private List<Object> cashe = new ArrayList<>();

    // í¬ì¸íŠ¸ì»· ì ìš©
    @Pointcut("execution(* cal*(..))")
    public void cacheTarget() {
    }

    // ì–´ë“œë°”ì´ìŠ¤ ì •ì˜
    @Around("cacheTarget()")
    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {

        // ë°ì´í„° ì´ˆê¸°í™”
        Object[] argumentObject = joinPoint.getArgs();
        String argumentToString = Arrays.toString(argumentObject);

        // ë§Œì•½ ë°ì´í„°ê°€ ìˆë‹¤ë©´, ìºì‹œì—ì„œ êº¼ë‚´ì„œ ì „ë‹¬
        if(cashe.size() != 0) {
            for (Object element : cashe) {

                String elementToString = Arrays.toString((Object[]) element);

                if (elementToString.equals(argumentToString)) {
                    System.out.printf("ìºì‹œì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°[%s]\n", elementToString);
                    return elementToString;
                }
            }
        }

        // ë°ì´í„°ê°€ ì—†ë‹¤ë©´, íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìºì‹œì— ë°ì´í„° ì¶”ê°€ 
        Object result = joinPoint.proceed();
        cashe.add(argumentObject);
        System.out.printf("ìºì‹œì— ë°ì´í„° ì¶”ê°€[%s]\n", Arrays.toString(argumentObject));

        return result;
    }
}
```

ìœ„ì˜ ì½”ë“œëŠ” ê°„ë‹¨í•˜ê²Œ ìºì‹œ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ìƒˆë¡œìš´ ì• ìŠ¤í™íŠ¸ë¥¼ ë³´ì—¬ì¤€ë‹¤.

@Aroundì˜ ê°’ìœ¼ë¡œ **cacheTarget()** ë©”ì„œë“œë¥¼ ì„¤ì •í–ˆë‹¤.

<div class="cl3"></div>

ë¨¼ì € ArrayListë¡œ ìºì‹œ ì €ì¥ì†Œë¥¼ ë§Œë“  ë‹¤ìŒ,

ë§Œì•½ ë°›ì•„ì˜¨ ë°ì´í„°ì™€ ì¼ì¹˜í•˜ëŠ” ê°’ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë¦¬í„´í•˜ê³ 

ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” íƒ€ê¹ƒ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìºì‹œì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ë„ë¡ í–ˆë‹¤.

í¸ì˜ìƒ ì‹¤ì œ ë°ì´í„°ëŠ” ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê³  â€œìºì‹œì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°â€ë¼ëŠ” ë¬¸êµ¬ë§Œ ì¶œë ¥í•œë‹¤.

ì´ë ‡ê²Œ êµ¬í˜„í•œ ìƒˆë¡œìš´ ì• ìŠ¤í™íŠ¸ë¥¼ êµ¬ì„± í´ë˜ìŠ¤ì— ì¶”ê°€í•´ì„œ ì‚¬ìš©í•´ ë³´ë„ë¡ í•˜ê² ë‹¤.

<div class="cl3"></div>

**GugudanConfig êµ¬ì„± í´ë˜ìŠ¤**

```java
@Configuration
@EnableAspectJAutoProxy
public class GugudanConfig {

    // ìƒˆë¡œìš´ ì• ìŠ¤í™íŠ¸ ì¶”ê°€
    @Bean
    public GugudanCacheAspect casheAspect() {
        return new GugudanCacheAspect();
    }

    @Bean
    public GugudanAspect gugudanAspect() {
        return new GugudanAspect();
    }

    @Bean
    public Gugudan gugudan() {
        return new GugudanByRecursion();
    }
}
```

<div class="cl3"></div>

**GugudanTest í´ë˜ìŠ¤**

```java
public class GugudanTest {

    public static void main(String[] args) {

        AnnotationConfigApplicationContext annotationConfigApplicationContext = new AnnotationConfigApplicationContext(GugudanConfig.class);

        Gugudan gugudan = annotationConfigApplicationContext.getBean("gugudan", Gugudan.class);

        // ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ë©”ì„œë“œ 3ë²ˆ í˜¸ì¶œ
        gugudan.calculate(2,1);
        gugudan.calculate(2,1);
        gugudan.calculate(2,1);

    }
}
```

<div class="cl3"></div>

**ì¶œë ¥ ê²°ê³¼**

<div class="cl4"></div>

<p align="center"><img src="../images/68md8.png"></p>

<div class="cl4"></div>

ì‹¤í–‰ì‹œê°„ì— ëŒ€í•œ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì€ GugudanAspectê°€, ìºì‹œì— ëŒ€í•œ ê³µí†µ ê¸°ëŠ¥ì€ GugudanCacheAspectê°€ ì¶œë ¥í•˜ê³  ìˆë‹¤.

<div class="cl3"></div>

ë˜í•œ, ìºì‹œ ê¸°ëŠ¥ì´ ì˜ ì ìš©ë˜ì–´ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë©”ì„œë“œë¥¼ 3ë²ˆ í˜¸ì¶œí–ˆì„ ë•Œ

ì²« ë²ˆì§¸ í˜¸ì¶œì—ì„œë§Œ GugudanAspectì™€ GugudanCacheAspectê°€ ëª¨ë‘ ë™ì‘í•˜ê³ , ë‚˜ë¨¸ì§€ ë‘ ë²ˆì€ ìºì‹œì— ëŒ€í•œ ê³µí†µ ê¸°ëŠ¥ë§Œ ì‚¬ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<div class="cl3"></div>

ì´ëŸ¬í•œ ì¶œë ¥ íë¦„ì´ ë°œìƒëœ ê²ƒì€ ë‘ ê°œì˜ ì–´ë“œë°”ì´ìŠ¤ê°€ ë‹¤ìŒì˜ ìˆœì„œë¡œ ì ìš©ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

<p align="center"><img src="../images/68md9.png"></p>

<div class="cl3"></div>

ìœ„ì˜ GugudanTest í´ë˜ìŠ¤ì—ì„œ `getBean()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë¹ˆ ê°ì²´ì˜ íƒ€ì…ì€ GugudanCacheAspect í”„ë¡ì‹œ ê°ì²´ì´ë‹¤.

```java
annotationConfigApplicationContext.getBean("gugudan", Gugudan.class);
```

<div class="cl3"></div>

ê·¸ë¦¬ê³  GugudanCacheAspect í”„ë¡ì‹œ ê°ì²´ì˜ íƒ€ê¹ƒ ê°ì²´ëŠ” ë‹¤ì‹œ GugudanAspectì´ë©°,

ìµœì¢…ì ìœ¼ë¡œ GugudanAspect í”„ë¡ì‹œ ê°ì²´ê°€ ê·¸ íƒ€ê¹ƒ ê°ì²´ì¸ GugudanByRecursion êµ¬í˜„ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹ì´ë‹¤.

<div class="cl3"></div>

ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ì½”ë“œë¥¼ í†µí•´ í™•ì¸í•´ ë³´ë©´

ê°€ì¥ ë¨¼ì €, GugudanTestì˜ `gugudan.calculate(2,1)` ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë©´ ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ GugudanCacheAspect í”„ë¡ì‹œ ê°ì²´ê°€ ë™ì‘í•œë‹¤.

<div class="cl3"></div>

**GugudanCacheAspect í´ë˜ìŠ¤**

```java
@Aspect
public class GugudanCacheAspect {

    // ìºì‹œ ì €ì¥ì†Œ
    private List<Object> cashe = new ArrayList<>();

    --- ìƒëµ ---

    // ì–´ë“œë°”ì´ìŠ¤ ì •ì˜
    @Around("cacheTarget()")
    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {

        --- ìƒëµ ---

        // (1) ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— joinPoint.proceed() í˜¸ì¶œ
        Object result = joinPoint.proceed();

        // (5) ìºì‹œì— ë°ì´í„° ì¶”ê°€ ë° ë©”ì‹œì§€ ì¶œë ¥
        cashe.add(argumentObject);
        System.out.printf("ìºì‹œì— ë°ì´í„° ì¶”ê°€[%s]\n", Arrays.toString(argumentObject));

        return result;
    }
}
```

ìµœì´ˆ í˜¸ì¶œ ì‹œ ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— (1) `joinPoint.proceed()` ë©”ì„œë“œê°€ í˜¸ì¶œì´ ë˜ëŠ”ë°,

ê·¸ ëŒ€ìƒ ê°ì²´ê°€ GugudanAspect í”„ë¡ì‹œ ê°ì²´ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê°ì²´ì˜ `measureTime()` ë©”ì„œë“œê°€ ì‹¤í–‰ëœë‹¤.

<div class="cl3"></div>

**GugudanAspect í´ë˜ìŠ¤**

```java
@Aspect
public class GugudanAspect {

    --- ìƒëµ --- 

    @Around("targetMethod()")
    public Object measureTime(ProceedingJoinPoint joinPoint) throws Throwable {

        long start = System.nanoTime();

        try {
            // (2) ì‹¤ì œ íƒ€ê¹ƒ ê°ì²´ ë©”ì„œë“œ í˜¸ì¶œ -> GugudanByRecursion í´ë˜ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ
            Object result = joinPoint.proceed();
            return result;
        } finally {
            // (4) ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ ì¶œë ¥
            long end = System.nanoTime();
            Signature signature = joinPoint.getSignature();
            System.out.printf("%s.%s ë©”ì„œë“œ í˜¸ì¶œ!\n", joinPoint.getTarget().getClass().getSimpleName(), signature.getName());
            System.out.printf("ì‹¤í–‰ ì‹œê°„: %d ns\n", (end-start));
            System.out.println("----------------------------");
        }
    }
}
```

<div class="cl3"></div>

**GugudanByRecursion í´ë˜ìŠ¤**

```java
public class GugudanByRecursion implements Gugudan {

    // (3) ì‹¤ì œ íƒ€ê¹ƒ ê°ì²´ ë©”ì„œë“œ í˜¸ì¶œ
    @Override
    public void calculate(int level, int count) {

        if(count > 9) {
            return;
        }
        System.out.printf("%d x %d = %d\n", level, count, level*count);
        calculate(level, ++count);;
    }
}
```

<div class="cl3"></div>

`measureTime` ë©”ì„œë“œëŠ” ìœ„ì™€ ê°™ì´ ë‹¤ì‹œ (2) - (3) ì‹¤ì œ íƒ€ê¹ƒ ê°ì²´ ë©”ì„œë“œì¸ GugudanByRecursionì˜ `calculate(int level, int count)` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³ , ì´ì–´ì„œ (4) ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ ì¶œë ¥í•œë‹¤.

<div class="cl3"></div>

ë§ˆì§€ë§‰ìœ¼ë¡œ, ë‹¤ì‹œ GugudanCacheAspect í´ë˜ìŠ¤ì—ì„œ (5) ë°˜í™˜ëœ ê°’ì„ ìºì‹œì— ìƒˆë¡­ê²Œ ì¶”ê°€í•˜ê³ , ì´ë¥¼ í™•ì¸í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.

ê·¸ëŸ¬ë‚˜ ë‘ ë²ˆì§¸ `gugudan.calculate(2,1)` í˜¸ì¶œë¶€í„°ëŠ” ìºì‹œ ê¸°ëŠ¥ì„ í†µí•´ ê¸°ì¡´ì— ì €ì¥ëœ ë°ì´í„°ê°€ ë°˜í™˜ë˜ê¸° ë•Œë¬¸ì— GugudanAspect í´ë˜ìŠ¤ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

<div class="cl3"></div>

ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ë˜ëŠ” ìˆœì„œëŠ” GugudanCacheAspect í”„ë¡ì‹œ â‡’ GugudanAspect í”„ë¡ì‹œ â‡’ GugudanByRecursion ê°ì²´ ìˆœì´ë©°,

ì´ì— ë”°ë¼ ê°ê° í•´ë‹¹í•˜ëŠ” ë©”ì„œë“œê°€ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ëˆˆìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<div class="cl3"></div>

ë§Œì•½ ì´ ìˆœì„œë¥¼ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ @Order ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<div class="cl3"></div>

**GugudanAspect í´ë˜ìŠ¤**

```java
@Aspect
@Order(value = 1) // ğŸ›‘ ì¶”ê°€ 
public class GugudanAspect {

    --- ìƒëµ ---

}
```

<div class="cl3"></div>

**GugudanCasheAspect í´ë˜ìŠ¤**

```java
@Aspect
@Order(value = 2) // ğŸ›‘ ì¶”ê°€ 
public class GugudanCacheAspect {

    --- ìƒëµ ---

}
```

<div class="cl3"></div>

**ì¶œë ¥ ê²°ê³¼**

<div class="cl4"></div>

<p align="center"><img src="../images/68md10.png"></p>

{% include banner-spring.html %}